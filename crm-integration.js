(function(){"use strict";const u={TRUSENDA_SLUG:"zacharyvorsteg",TRUSENDA_API_URL:"https://trusenda.com/.netlify/functions"};let l=null,m=!1;document.addEventListener("DOMContentLoaded",function(){console.log("\u{1F680} Initializing Trusenda CRM Integration...");const t=document.getElementById("lead-form");t?(t.addEventListener("submit",p),console.log("\u2705 Form submission handler attached")):console.error("\u274C Lead form not found on page");const e=localStorage.getItem("trusenda_tenant_id");e&&(l=e,console.log("\u2705 Tenant ID loaded from cache:",l)),f()});async function f(){try{console.log(`\u{1F4E1} Fetching tenant info for slug: ${u.TRUSENDA_SLUG}`);const t=await fetch(`${u.TRUSENDA_API_URL}/get-public-form?slug=${u.TRUSENDA_SLUG}`);if(!t.ok)throw new Error(`Failed to fetch tenant info: ${t.status}`);return l=(await t.json()).tenantId,localStorage.setItem("trusenda_tenant_id",l),console.log("\u2705 Tenant ID retrieved successfully:",l),l}catch(t){return console.error("\u274C Error fetching tenant ID:",t),null}}async function p(t){if(t.preventDefault(),m){console.warn("\u26A0\uFE0F Form submission already in progress");return}m=!0,console.log("\u{1F4DD} Form submission started...");const e=t.target,s=document.getElementById("submit-btn"),o=document.getElementById("btn-text"),c=document.getElementById("btn-loading"),i=document.getElementById("form-message");s.disabled=!0,o.classList.add("hidden"),c.classList.remove("hidden"),i.classList.add("hidden");try{if(!l&&(console.log("\u26A0\uFE0F Tenant ID not available, fetching now..."),await f(),!l))throw new Error("Unable to connect to CRM. Please try again later.");const n=g(e);console.log("\u{1F4E6} Submitting lead data:",n);const r=await fetch(`${u.TRUSENDA_API_URL}/ingest-lead`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),a=await r.json();if(r.status===201||r.ok)console.log("\u2705 Lead submitted successfully:",a),b();else throw r.status===402?new Error("Sorry, we're at capacity right now. Please call us directly at 561-718-6725."):new Error(a.error||"Failed to submit form. Please try again.")}catch(n){console.error("\u274C Form submission error:",n),I(n.message),s.disabled=!1,o.classList.remove("hidden"),c.classList.add("hidden")}finally{m=!1}}function g(t){const e=new FormData(t),s=e.get("space_size");let o=null,c=null;if(s)if(s.includes("-")){const n=s.split("-").map(r=>r.replace(/,/g,"").trim());o=parseInt(n[0],10),c=parseInt(n[1],10)}else if(s.includes("+")){const n=s.match(/(\d+)/);n&&(o=parseInt(n[1],10))}else{const n=s.match(/(\d+)/);n&&(o=parseInt(n[1],10))}return{tenant_id:l,name:e.get("name"),email:e.get("email")||null,phone:e.get("phone")||null,company:e.get("company")||null,budget:e.get("budget")||null,sizeMin:o,sizeMax:c,propertyType:e.get("property_use")||"Warehouse",moveTiming:e.get("move_date")||null,industry:e.get("industry")||null,leaseTerm:e.get("lease_term")||null,preferredArea:(function(){const n=e.get("preferred_location_value"),r=e.get("preferred_location");return n||(r&&r.trim()?(console.warn("\u26A0\uFE0F Location not confirmed from dropdown. User typed:",r),r):"Palm Beach County, FL")})(),searchRadiusMiles:parseInt(e.get("search_radius"),10)||25,notes:y(e)}}function y(t){const e=[];e.push("Source: palmbeachwarehouses.com");const s=[],o=t.get("req_docks"),c=t.get("req_clearheight"),i=t.get("req_power"),n=t.get("req_climate"),r=t.get("req_office");o&&s.push(o),c&&s.push(c),i&&s.push(i),n&&s.push(n),r&&s.push(r),["req_grade","req_semi","req_yard","req_trailer","req_247","req_fenced"].forEach(L=>{const h=t.get(L);h&&s.push(h)}),s.length>0&&e.push("Requirements: "+s.join(", "));const d=t.get("notes");return d&&d.trim()&&e.push("Notes: "+d.trim()),e.join(`
`)}function b(){const t=document.getElementById("lead-form"),e=document.getElementById("success-message");t.classList.add("hidden"),e.classList.remove("hidden");const s=g(t),o=QUALIFICATION.scoreQualification(s);console.log(`\u{1F4CA} Lead Qualification: ${o.tier} (Score: ${o.score})`);const c=document.getElementById("success-callout");let i="",n=5;o.tier==="HOT"?(i="\u26A1 <strong>Priority Lead!</strong> Zach typically responds to high-urgency requests within 2 hours.",n=50):o.tier==="WARM"?(i="<strong>\u2713 Good fit!</strong> You should hear from Zach within 24 hours with matching properties.",n=25):(i="Zach will review your request and reach out if he finds matching spaces in your area.",n=5),c.innerHTML=i,c.style.display="block",typeof gtag<"u"&&(gtag("event","conversion",{send_to:"AW-17147516072/f_LJCMeD4tMaEKipyfA_",value:n,currency:"USD"}),console.log(`\u2705 Google Ads conversion fired (Value: $${n})`)),typeof fbq<"u"&&(fbq("track","Lead",{content_name:"Warehouse Inquiry",content_category:o.tier,value:n,currency:"USD"}),console.log(`\u2705 Facebook Lead conversion fired (Tier: ${o.tier})`))}function I(t){const e=document.getElementById("form-message");e.textContent=t,e.className="form-message error",e.classList.remove("hidden")}window.resetForm=function(){const t=document.getElementById("lead-form"),e=document.getElementById("success-message"),s=document.getElementById("submit-btn"),o=document.getElementById("btn-text"),c=document.getElementById("btn-loading"),i=document.getElementById("form-message");t.reset(),t.classList.remove("hidden"),e.classList.add("hidden"),s.disabled=!1,o.classList.remove("hidden"),c.classList.add("hidden"),i.classList.add("hidden"),document.querySelectorAll(".progress-step").forEach((a,d)=>{a.classList.remove("active","completed"),d===0&&a.classList.add("active")});const n=document.querySelector(".progress-fill");n&&(n.style.width="0%"),currentStep=1;const r=document.getElementById("step-1");document.querySelectorAll(".form-step").forEach(a=>a.classList.remove("active")),r&&(r.classList.add("active"),setTimeout(()=>{const a=r.querySelector("select, input");a&&a.focus()},100)),scrollToForm()},window.scrollToForm=function(){const t=document.getElementById("lead-form-section");t&&t.scrollIntoView({behavior:"smooth",block:"center"})},console.log("\u{1F389} Trusenda CRM Integration loaded successfully")})();
